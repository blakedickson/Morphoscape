<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="krige_surf() performs kriging (i.e., interpolation) of one or more functional characteristics that are spatially distributed over a morphospace to create a smoothly kriged surface. Interpolated values can also be produced for a new dataset given their coordinates in morphological space."><title>Interpolate functional characteristics over a grid — krige_surf • Morphoscape</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Interpolate functional characteristics over a grid — krige_surf"><meta property="og:description" content="krige_surf() performs kriging (i.e., interpolation) of one or more functional characteristics that are spatially distributed over a morphospace to create a smoothly kriged surface. Interpolated values can also be produced for a new dataset given their coordinates in morphological space."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">Morphoscape</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.2</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../articles/Morphoscape.html">Get started</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"></ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Interpolate functional characteristics over a grid</h1>
      
      <div class="d-none name"><code>krige_surf.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><code>krige_surf()</code> performs kriging (i.e., interpolation) of one or more functional characteristics that are spatially distributed over a morphospace to create a smoothly kriged surface. Interpolated values can also be produced for a new dataset given their coordinates in morphological space.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">krige_surf</span><span class="op">(</span><span class="va">fnc_df</span>, grid <span class="op">=</span> <span class="cn">NULL</span>, resample <span class="op">=</span> <span class="fl">100</span>, padding <span class="op">=</span> <span class="fl">1.2</span>, hull <span class="op">=</span> <span class="cn">NULL</span>, </span>
<span>  alpha <span class="op">=</span> <span class="fl">1</span>, new_data <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span>           </span>
<span>  </span>
<span><span class="fu">krige_new_data</span><span class="op">(</span><span class="va">x</span>, <span class="va">new_data</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>fnc_df</dt>
<dd><p>a <code>fnc_df</code> object; the output of a call to <code><a href="as_fnc_df.html">as_fnc_df</a></code>, which contains coordinates in morphological space and values of functional characteristics for the warps used to create the kriged surface.</p></dd>

  <dt>grid</dt>
<dd><p>a matrix or data frame containing the grid of points over which the surface is to be interpolated. Should be the output of a call to <code><a href="resample_grid.html">resample_grid</a></code>. If <code>NULL</code>, the grid will be formed by calling <code><a href="resample_grid.html">resample_grid()</a></code> on the inputs.</p></dd>

  <dt>resample</dt>
<dd><p>the number of points (or pixels) in the x and y dimensions over which to create the grid. Default is 100 for a kriged surface of 100x100=10,000 pixels. Passed to <code><a href="resample_grid.html">resample_grid</a></code>. Ignored when <code>grid</code> is not <code>NULL</code>.</p></dd>

  <dt>padding</dt>
<dd><p>a number representing how much to expand the grid beyond the ranges of the x- and y-coordinates. For example, <code>padding = 1.2</code> (the default) expands the grid by 20% of the coordinates' ranges in each direction. Must be a number greater than or equal to 1. Large numbers imply greater extrapolation, and whatever padding is added will be negated if <code>hull = TRUE</code>. Passed to <code><a href="resample_grid.html">resample_grid</a></code>. Ignored when <code>grid</code> is not <code>NULL</code>.</p></dd>

  <dt>hull</dt>
<dd><p>method to to restrict kriging to an alpha hull to prevent extrapolation beyond the coordinates present in <code>fnc_df</code>. Passed to <code><a href="resample_grid.html">resample_grid</a></code>, which uses <code>alphahull</code> or <code>concaveman</code> packages. Default is <code><a href="https://rdrr.io/pkg/alphahull/man/ahull.html" class="external-link">alphahull::ahull</a></code>. If no hull is desired set <code>hull = NULL</code>. If <code>NULL</code>, kriging will take place over a rectangular grid that spans the boundaries of the coordinates in <code>fnc_df</code>. Ignored when <code>grid</code> is not <code>NULL</code></p></dd>


  <dt>alpha</dt>
<dd><p>the alpha value used to create the alpha hull. Passed to <code><a href="resample_grid.html">resample_grid</a></code> and eventually to <code><a href="https://rdrr.io/pkg/alphahull/man/ahull.html" class="external-link">alphahull::ahull</a></code>. Ignored when <code>grid</code> is not <code>NULL</code>.</p></dd>

  <dt>new_data</dt>
<dd><p>a dataset of coordinates for a new sample; the values of the functional characteristics for this sample will be interpolated using the kriged surface.</p></dd>

  <dt>x</dt>
<dd><p>a <code>"kriged_surfaces"</code> object; the output of a call to <code>krige_surf()</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p><code>krige_surf()</code> implements the <code><a href="https://rdrr.io/pkg/automap/man/autoKrige.html" class="external-link">automap::autoKrige</a></code> function on one or more spatially distributed traits to produce an interpolated (or extrapolated) surface of evenly spaced gridpoints. This is done by automatiically finding the best variogram fit for each of the non-corrdinate variables in <code>fnc_df</code>. For details on automatic variogram fitting, see <code><a href="https://rdrr.io/pkg/automap/man/autoKrige.html" class="external-link">automap::autoKrige</a></code>.</p>
<p>Input data in <code>fnc_df</code> can be unevenly distributed (direct from speciments), or gridded (determined from evenly distributed hypothetical shapes) in morphospace. Trait data inputted directly from specimen measurements will be subject to error based on the how unevenly points are distributed, with high resoultion gridded datapoints producing the least potential reconstruction error (see Smith et al 2021).</p>
<p>By default <code>krige_surf</code> will create a <code>hull</code> to strictly prevent any extrapolation beyond the provided data. This will produce the most conservative landscapes. If <code>hull</code> is set to <code>FALSE</code>, then the function will reconstruct a rectangle determined by the XY coordinate ranges supplied in <code>fnc_df</code>. Padding will be applied by default (an extra 20%) as defined by <code>padding</code>, to expand the rectangle beyond the supplied points. Reconstructions without a <code>hull</code> would be most appropriate for trait data determined from evenely spaced hypothetical gridpoints. If <code>grid</code> is provided the function will strictly interpolate at these gridded points.</p>

<p><code>krige_new_data()</code> adds a new data set to the supplied <code>kriged_surfaces</code> object and interpolates the values of the functional characteristics on the suppllied sample. This should only be used to add a new dataset to a <code>kriged_surfaces</code> object produced without <code>new_data</code> supplied or to replace an existing <code>new_data</code> component.</p>
    </div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>An object of class <code>kriged_surfaces</code> containing the following components:</p>
<dl><dt>fnc_df</dt>
<dd><p>the original data frame of functional characteristics passed to <code>fnc_df</code>.</p></dd>

<dt>autoKrige</dt>
<dd><p>a named list of the kriged surfaces, one for each functional characteristic. Each surface is of class <code>autoKrige</code>, the output of the call to <code><a href="https://rdrr.io/pkg/automap/man/autoKrige.html" class="external-link">automap::autoKrige</a></code>.</p></dd>

<dt>dataframes</dt>
<dd><p>a list of two data frames, <code>grid</code> and <code>new_data</code>. <code>grid</code> contains the coordinates of the kriged surface grid (in the <code>x</code> and <code>y</code> columns) as well as the interpolated values of the functional characteristics. <code>new_data</code> contains the sample coordinates supplied to <code>new_data</code> as well as the interpolated values of the functional characteristics for each sample. This second component is absent if <code>new_data = NULL</code> in the call to <code>krige_surf()</code>.</p></dd>


</dl><p>For <code>krige_new_data()</code>, the original <code>kriged_surfaces</code> object, with the <code>$dataframes$new_data</code> component containing the sample coordinates supplied to <code>new_data</code> as well as the interpolated values of the functional characteristics for each sample.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Smith, S. M., Stayton, C. T., &amp; Angielczyk, K. D. (2021). How many trees to see the forest? Assessing the effects of morphospace coverage and sample size in performance surface analysis. Methods in Ecology and Evolution, 12(8), 1411-1424.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="plot.kriged_surfaces.html">plot.kriged_surfaces</a></code> for plotting the kriged surfaces.</p>
<p><code><a href="as_fnc_df.html">as_fnc_df</a></code> for creating the input dataset.</p>
<p><code><a href="resample_grid.html">resample_grid</a></code> for creating the grid over which the kriging occurs prior to using <code>krige_surf</code>.</p>
<p><code><a href="https://rdrr.io/pkg/automap/man/autoKrige.html" class="external-link">automap::autoKrige</a></code> for the function that does the kriging.</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"warps"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">warps_fnc</span> <span class="op">&lt;-</span> <span class="fu"><a href="as_fnc_df.html">as_fnc_df</a></span><span class="op">(</span><span class="va">warps</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="resample_grid.html">resample_grid</a></span><span class="op">(</span><span class="va">warps</span>, hull <span class="op">=</span> <span class="st">"concaveman"</span>, plot <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="krige_surf-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">kr_surf</span> <span class="op">&lt;-</span> <span class="fu">krige_surf</span><span class="op">(</span><span class="va">warps_fnc</span>, grid <span class="op">=</span> <span class="va">grid</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [using ordinary kriging]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [using ordinary kriging]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [using ordinary kriging]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [using ordinary kriging]</span>
<span class="r-in"><span><span class="va">kr_surf</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> A kriged_surfaces object</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - functional characteristics:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 	hydro, curve, mech, fea</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - surface size:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 	70 by 70</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 	α-hull applied (α = 1)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - original data:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 	24 rows</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Add new data</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"turtles"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">kr_surf</span> <span class="op">&lt;-</span> <span class="fu">krige_new_data</span><span class="op">(</span><span class="va">kr_surf</span>, new_data <span class="op">=</span> <span class="va">turtles</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [using ordinary kriging]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [using ordinary kriging]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [using ordinary kriging]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [using ordinary kriging]</span>
<span class="r-in"><span><span class="va">kr_surf</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> A kriged_surfaces object</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - functional characteristics:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 	hydro, curve, mech, fea</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - surface size:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 	70 by 70</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 	α-hull applied (α = 1)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - original data:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 	24 rows</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - new data:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 	40 rows</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">kr_surf</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="krige_surf-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Doing it all in one step:</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="va">kr_surf</span> <span class="op">&lt;-</span> <span class="fu">krige_surf</span><span class="op">(</span><span class="va">warps_fnc</span>, new_data <span class="op">=</span> <span class="va">turtles</span>, hull <span class="op">=</span> <span class="st">"alphahull"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">kr_surf</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># No hull and padding</span></span></span>
<span class="r-in"><span><span class="va">kr_surf</span> <span class="op">&lt;-</span> <span class="fu">krige_surf</span><span class="op">(</span><span class="va">warps_fnc</span>, new_data <span class="op">=</span> <span class="va">turtles</span>, hull <span class="op">=</span> <span class="cn">NULL</span>, padding <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [using ordinary kriging]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [using ordinary kriging]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [using ordinary kriging]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [using ordinary kriging]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [using ordinary kriging]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [using ordinary kriging]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [using ordinary kriging]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [using ordinary kriging]</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">kr_surf</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="krige_surf-3.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Blake Dickson, Stephanie Pierce, Noah Greifer.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

